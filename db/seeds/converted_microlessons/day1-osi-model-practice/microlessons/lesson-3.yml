slug: lesson-3
title: Lesson 3
difficulty: easy
sequence_order: 3
estimated_minutes: 2
key_concepts: []
prerequisites: []
content_md: "# Microlesson \U0001F680\n\n# Day 3: Network Services – DNS, DHCP, NAT\
  \ and Routing Essentials\n\n    ## Learning Goals\n\n    - Understand key network\
  \ services that make IP networks function\n    - Learn how DNS resolves names to\
  \ IP addresses\n    - Understand how DHCP automatically assigns IP configurations\n\
  \    - Master NAT concepts and why it's essential\n    - Grasp basic routing between\
  \ networks\n\n    ## The Four Pillars of Network Services\n\n    Modern networks\
  \ rely on four key services:\n    1. **DHCP** - Automatic IP configuration\n   \
  \ 2. **DNS** - Name to IP address resolution\n    3. **NAT** - Sharing public IPs\
  \ across private networks\n    4. **Routing** - Forwarding packets between networks\n\
  \n    ## DHCP (Dynamic Host Configuration Protocol)\n\n    ### What is DHCP?\n\n\
  \    DHCP automatically provides devices with their network configuration when they\
  \ join a network. Without DHCP, you'd have to manually configure every device!\n\
  \n    ### What DHCP Provides\n\n    When a device connects to a network, DHCP can\
  \ supply:\n    - **IP address** (e.g., 192.168.1.100)\n    - **Subnet mask** (e.g.,\
  \ 255.255.255.0)\n    - **Default gateway** (e.g., 192.168.1.1)\n    - **DNS server(s)**\
  \ (e.g., 8.8.8.8, 8.8.4.4)\n    - **Lease time** (how long the IP is valid)\n  \
  \  - **Domain name** (e.g., company.local)\n\n    ### DHCP Process (DORA)\n\n  \
  \  The DHCP handshake has four steps:\n\n    ```\n    1. DISCOVER: Client broadcasts\
  \ \"I need an IP!\"\n       Source: 0.0.0.0, Dest: 255.255.255.255 (broadcast)\n\
  \n    2. OFFER: DHCP server responds \"Here's 192.168.1.100\"\n       Server offers\
  \ available IP from its pool\n\n    3. REQUEST: Client broadcasts \"I'll take 192.168.1.100\"\
  \n       Client requests the offered IP\n\n    4. ACK: Server confirms \"192.168.1.100\
  \ is yours for 24 hours\"\n       Server acknowledges and activates the lease\n\
  \    ```\n\n    ### DHCP Components\n\n    - **DHCP Server**: Device that manages\
  \ IP address pool and leases\n      - Often your router in home networks\n     \
  \ - Dedicated server in enterprise networks\n      - Managed service in cloud environments\n\
  \n    - **DHCP Client**: Any device that requests automatic configuration\n    \
  \  - Laptops, phones, IoT devices, VMs\n\n    - **IP Address Pool**: Range of IPs\
  \ available for assignment\n      - Example: 192.168.1.100 - 192.168.1.200\n\n \
  \   - **Lease Time**: How long a client can use an IP before renewal\n      - Home\
  \ networks: Often 24 hours\n      - Enterprise: May be shorter for better control\n\
  \n    ### Static vs Dynamic IP\n\n    - **Dynamic (DHCP)**: IP assigned automatically,\
  \ can change\n      - Best for: Client devices, laptops, phones, non-critical servers\n\
  \n    - **Static**: Manually configured IP that doesn't change\n      - Best for:\
  \ Servers, printers, network equipment, DNS servers\n\n    ## DNS (Domain Name System)\n\
  \n    ### What is DNS?\n\n    DNS is the internet's \"phonebook\" – it translates\
  \ human-friendly domain names into IP addresses that computers use to communicate.\n\
  \n    **Without DNS**: You'd need to remember `142.250.64.78` instead of `google.com`\n\
  \n    ### How DNS Resolution Works\n\n    When you type `www.example.com` in your\
  \ browser:\n\n    ```\n    1. Browser checks local cache\n       → If found, use\
  \ cached IP\n\n    2. Browser asks OS resolver\n       → OS checks /etc/hosts (Linux/Mac)\
  \ or C:\\\\Windows\\\\System32\\\\drivers\\\\etc\\\\hosts\n\n    3. OS asks configured\
  \ DNS server (from DHCP or manual config)\n       → Usually your ISP's DNS or public\
  \ DNS like 8.8.8.8\n\n    4. DNS server checks its cache\n       → If not cached,\
  \ performs recursive resolution\n\n    5. Recursive resolution (if needed):\n  \
  \     a. Query root DNS servers (.) → \"Ask .com servers\"\n       b. Query TLD\
  \ servers (.com) → \"Ask example.com nameserver\"\n       c. Query authoritative\
  \ nameserver → \"www.example.com is 93.184.216.34\"\n\n    6. DNS server returns\
  \ IP to OS\n\n    7. OS returns IP to browser\n\n    8. Browser connects to 93.184.216.34\n\
  \    ```\n\n    ### DNS Record Types\n\n    | Record | Purpose | Example |\n   \
  \ |--------|---------|---------|\n    | **A** | Maps domain to IPv4 address | example.com\
  \ → 93.184.216.34 |\n    | **AAAA** | Maps domain to IPv6 address | example.com\
  \ → 2606:2800:220:1:... |\n    | **CNAME** | Alias from one domain to another |\
  \ www.example.com → example.com |\n    | **MX** | Mail server for domain | example.com\
  \ → mail.example.com (priority 10) |\n    | **TXT** | Text information (SPF, DKIM,\
  \ verification) | Various metadata |\n    | **NS** | Nameserver for domain | example.com\
  \ → ns1.provider.com |\n    | **PTR** | Reverse DNS (IP to domain) | 93.184.216.34\
  \ → example.com |\n\n    ### DNS in Practice\n\n    **Home Network**:\n    - Router\
  \ acts as DNS forwarder\n    - Forwards queries to ISP DNS or configured DNS (e.g.,\
  \ 8.8.8.8)\n\n    **Enterprise**:\n    - Internal DNS servers for company domains\
  \ (e.g., server1.company.local)\n    - Forward public queries to internet DNS\n\n\
  \    **Cloud (AWS/Azure/GCP)**:\n    - Managed DNS services (Route 53, Azure DNS,\
  \ Cloud DNS)\n    - Internal DNS for VPC/VNet resources\n\n    ### Public DNS Servers\n\
  \n    | Provider | IPv4 | Purpose |\n    |----------|------|---------|\n    | Google\
  \ | 8.8.8.8, 8.8.4.4 | Fast, reliable |\n    | Cloudflare | 1.1.1.1, 1.0.0.1 | Privacy-focused,\
  \ fast |\n    | Quad9 | 9.9.9.9 | Security filtering |\n    | OpenDNS | 208.67.222.222,\
  \ 208.67.220.220 | Content filtering |\n\n    ## NAT (Network Address Translation)\n\
  \n    ### What is NAT?\n\n    NAT allows multiple devices on a private network to\
  \ share a single public IP address when accessing the internet.\n\n    **Why NAT\
  \ Exists:**\n    - IPv4 address exhaustion (not enough public IPs for every device)\n\
  \    - Security (hide internal network structure)\n    - Cost (public IPs cost money)\n\
  \n    ### How NAT Works\n\n    **Scenario**: Home network with multiple devices\
  \ behind a router\n\n    ```\n    Internal Network (Private): 192.168.1.0/24\n \
  \   Router's Public IP: 203.0.113.5\n\n    Device A (192.168.1.100) wants to visit\
  \ Google (142.250.64.78)\n\n    Step 1: Device sends packet\n      Source: 192.168.1.100:54321\n\
  \      Dest: 142.250.64.78:443\n\n    Step 2: Router (NAT) modifies packet\n   \
  \   Source: 203.0.113.5:54321 ← Changed!\n      Dest: 142.250.64.78:443\n      [Router\
  \ records: 192.168.1.100:54321 → 203.0.113.5:54321]\n\n    Step 3: Google responds\n\
  \      Source: 142.250.64.78:443\n      Dest: 203.0.113.5:54321\n\n    Step 4: Router\
  \ translates back\n      [Looks up: 54321 → 192.168.1.100:54321]\n      Source:\
  \ 142.250.64.78:443\n      Dest: 192.168.1.100:54321 ← Changed back!\n\n    Step\
  \ 5: Device receives response\n    ```\n\n    ### Types of NAT\n\n    1. **Static\
  \ NAT**: One-to-one mapping\n       - One private IP always maps to one specific\
  \ public IP\n       - Used for servers that need consistent public access\n\n  \
  \  2. **Dynamic NAT**: Many-to-many mapping\n       - Pool of public IPs shared\
  \ among private IPs\n       - First-come, first-served\n\n    3. **PAT (Port Address\
  \ Translation)** / NAT Overload: Many-to-one\n       - Most common type\n      \
  \ - Many private IPs share ONE public IP\n       - Uses different port numbers to\
  \ distinguish connections\n\n    ### NAT in Cloud Environments\n\n    **AWS**:\n\
  \    - **NAT Gateway**: Managed NAT service for private subnets\n    - **Internet\
  \ Gateway**: Provides NAT for instances with public IPs\n\n    **Azure**:\n    -\
  \ **Azure NAT Gateway**: Outbound internet connectivity for VNets\n\n    **GCP**:\n\
  \    - **Cloud NAT**: Managed NAT service\n\n    ## Routing Basics\n\n    ### What\
  \ is Routing?\n\n    **Routing** is the process of forwarding IP packets between\
  \ networks. A **router** is a device (or software function) that performs this forwarding.\n\
  \n    ### How Routing Works\n\n    Every device has a **routing table** that determines\
  \ where to send packets:\n\n    ```\n    Example routing table for host 10.0.1.5:\n\
  \n    Destination        Gateway        Interface\n    10.0.1.0/24        *    \
  \          eth0       (Direct: same subnet)\n    0.0.0.0/0          10.0.1.1   \
  \    eth0       (Default: everything else)\n    ```\n\n    **Decision process**:\n\
  \    1. Packet destined for 10.0.1.100 → Same subnet → Send directly via eth0\n\
  \    2. Packet destined for 8.8.8.8 → No specific route → Send to default gateway\
  \ 10.0.1.1\n\n    ### Default Gateway\n\n    The **default gateway** is the router\
  \ that handles all traffic destined for other networks.\n\n    **Example**:\n  \
  \  - Your laptop: 192.168.1.100\n    - Default gateway: 192.168.1.1 (your router)\n\
  \    - To reach Google (8.8.8.8), laptop sends packet to 192.168.1.1\n    - Router\
  \ forwards packet toward the internet\n\n    ### Routing Between Networks\n\n  \
  \  ```\n    Network A: 10.0.1.0/24 ←→ Router ←→ Network B: 10.0.2.0/24\n\n    Host\
  \ A (10.0.1.5) sends packet to Host B (10.0.2.10):\n\n    1. Host A checks routing\
  \ table: 10.0.2.0/24 not in local subnet\n    2. Host A sends to default gateway\
  \ (10.0.1.1)\n    3. Router receives packet, checks its routing table\n    4. Router\
  \ knows 10.0.2.0/24 is on its eth1 interface\n    5. Router forwards packet to 10.0.2.10\n\
  \    6. Host B receives packet\n    ```\n\n    ### Static vs Dynamic Routing\n\n\
  \    **Static Routing**:\n    - Routes manually configured by administrator\n  \
  \  - Simple, predictable\n    - Doesn't adapt to network changes\n    - Good for\
  \ small networks\n\n    **Dynamic Routing**:\n    - Routers automatically discover\
  \ routes and adapt to changes\n    - Uses routing protocols: RIP, OSPF, EIGRP, BGP\n\
  \    - Scales to large networks\n    - More complex but more resilient\n\n    ##\
  \ Putting It All Together: Complete Scenario\n\n    **Scenario**: You connect your\
  \ laptop to Wi-Fi and visit google.com\n\n    ### Step-by-Step Flow\n\n    ```\n\
  \    1. DHCP Configuration\n       - Laptop sends DHCP DISCOVER\n       - Router\
  \ responds with DHCP OFFER: 192.168.1.100/24\n       - Laptop accepts, gets: IP,\
  \ subnet, gateway (192.168.1.1), DNS (8.8.8.8)\n\n    2. DNS Resolution\n      \
  \ - Laptop asks DNS server (8.8.8.8): \"What's the IP for google.com?\"\n      \
  \ - DNS responds: \"142.250.64.78\"\n\n    3. Routing Decision\n       - Laptop\
  \ checks: 142.250.64.78 not in local subnet (192.168.1.0/24)\n       - Sends packet\
  \ to default gateway (192.168.1.1)\n\n    4. NAT Translation\n       - Router (NAT)\
  \ receives packet from 192.168.1.100:54321\n       - Changes source to router's\
  \ public IP: 203.0.113.5:54321\n       - Records mapping in NAT table\n\n    5.\
  \ Internet Routing\n       - Packet travels through ISP routers to Google's network\n\
  \       - Google responds to 203.0.113.5:54321\n\n    6. NAT Translation (Return)\n\
  \       - Router receives response on port 54321\n       - Looks up NAT table: 54321\
  \ → 192.168.1.100:54321\n       - Forwards to laptop\n\n    7. Application\n   \
  \    - Laptop's browser receives data\n       - Displays Google homepage\n    ```\n\
  \n    ## Key Takeaways\n\n    1. **DHCP** automatically configures devices with\
  \ IP, gateway, DNS, and more\n    2. **DNS** translates domain names to IP addresses\
  \ via recursive resolution\n    3. **NAT** allows multiple private IPs to share\
  \ one public IP using port mapping\n    4. **Routing** forwards packets between\
  \ networks using routing tables and gateways\n    5. **Default gateway** is the\
  \ router that handles traffic to other networks\n    6. All four services work together\
  \ to enable seamless internet connectivity\n\n    ## Common Troubleshooting\n\n\
  \    | Problem | Likely Service | What to Check |\n    |---------|---------------|---------------|\n\
  \    | No IP address | DHCP | Is DHCP server running? IP pool exhausted? |\n   \
  \ | Can't resolve names | DNS | Check DNS server config, try `nslookup` or `dig`\
  \ |\n    | Can't reach internet | NAT/Routing | Check gateway IP, NAT configuration,\
  \ routing table |\n    | Local network works, internet doesn't | Gateway/NAT | Verify\
  \ default gateway, NAT rules, ISP connection |"
exercises:
  - type: multiple_choice_question
    sequence_order: 1
    question: "What are the four steps of the DHCP handshake (DORA)?"
    options:
      - "Discover, Offer, Request, Acknowledge"
      - "Detect, Obtain, Retrieve, Accept"
      - "Download, Organize, Receive, Activate"
      - "Deploy, Open, Route, Assign"
    correct_answer: "Discover, Offer, Request, Acknowledge"
    explanation: "The DHCP handshake follows a four-step process known as DORA: Discover, Offer, Request, and Acknowledge. First, when a client connects to a network, it broadcasts a DHCP DISCOVER message (source 0.0.0.0 to destination 255.255.255.255) essentially asking 'I need an IP address!' Second, a DHCP server responds with a DHCP OFFER containing an available IP address from its pool. Third, the client broadcasts a DHCP REQUEST indicating it will accept the offered IP address (broadcast so other DHCP servers know the offer was accepted). Finally, the server sends a DHCP ACK (acknowledgment) confirming the IP lease and providing additional network configuration like subnet mask, default gateway, DNS servers, and lease duration. This process is broadcast-based because the client doesn't yet have an IP address to use for direct communication. Understanding DORA is crucial for troubleshooting network connectivity issues, as problems at any step can prevent devices from obtaining network configuration and accessing resources."
    require_pass: true
  - type: multiple_choice_question
    sequence_order: 2
    question: "How does DNS recursion work when resolving www.example.com?"
    options:
      - "The client directly contacts example.com's server"
      - "DNS server queries root servers, then TLD servers, then authoritative nameserver in sequence"
      - "All DNS servers are queried simultaneously"
      - "The browser caches resolve all DNS queries"
    correct_answer: "DNS server queries root servers, then TLD servers, then authoritative nameserver in sequence"
    explanation: "DNS recursive resolution follows a hierarchical process to resolve domain names to IP addresses. When your configured DNS server (like 8.8.8.8) doesn't have a cached answer for www.example.com, it performs recursive resolution by querying the DNS hierarchy. First, it queries the root DNS servers (indicated by .) asking 'Who handles .com domains?' The root servers respond with the addresses of TLD (Top-Level Domain) servers for .com. Second, the DNS server queries the .com TLD servers asking 'Who is authoritative for example.com?' The TLD servers respond with the nameserver addresses for example.com. Third, the DNS server queries example.com's authoritative nameserver asking 'What is the IP address for www.example.com?' The authoritative server responds with the actual IP address (e.g., 93.184.216.34). The DNS server then returns this IP to your operating system, which provides it to the application. This hierarchical system enables distributed management of domain names while allowing efficient caching at each level to reduce subsequent lookup times."
    require_pass: true
  - type: multiple_choice_question
    sequence_order: 3
    question: "What is PAT (Port Address Translation) and why is it commonly used?"
    options:
      - "It assigns static IP addresses to devices"
      - "It allows many private IPs to share one public IP using different port numbers"
      - "It encrypts network traffic"
      - "It routes packets between different networks"
    correct_answer: "It allows many private IPs to share one public IP using different port numbers"
    explanation: "PAT (Port Address Translation), also called NAT Overload, is the most common type of NAT used in home and small business networks. It allows multiple devices on a private network (like 192.168.1.x) to share a single public IP address when accessing the internet. PAT works by tracking each connection using both IP address and port number combinations. When device 192.168.1.100:54321 connects to Google at 142.250.64.78:443, the router changes the source to its public IP 203.0.113.5:54321 and records this mapping in its NAT table. When the response arrives at 203.0.113.5:54321, the router looks up which internal device and port to forward it to. Since each connection uses a unique port number, the router can maintain thousands of simultaneous connections from different internal devices, all sharing one public IP. This is essential because of IPv4 address exhaustion - there aren't enough public IPv4 addresses for every device, and purchasing public IPs is expensive. PAT provides both IP address conservation and a layer of security by hiding the internal network structure from the internet."
    require_pass: true
