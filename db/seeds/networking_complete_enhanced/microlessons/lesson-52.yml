slug: lesson-52
title: Lesson 52
sequence_order: 52
estimated_minutes: 2
difficulty: easy
content_md: "# Microlesson \U0001F680\n\n# DNS and Service Discovery in Kubernetes\n\
  \n## Introduction\n\nDNS is a critical component of Kubernetes networking, enabling\
  \ service discovery and communication between pods. CoreDNS is the default DNS server\
  \ in Kubernetes clusters, providing name resolution for services and pods.\n\n##\
  \ CoreDNS in Kubernetes\n\nCoreDNS is a flexible, extensible DNS server that serves\
  \ as the cluster DNS in Kubernetes. It:\n- Provides DNS-based service discovery\n\
  - Resolves service names to cluster IPs\n- Supports custom DNS configurations\n\
  - Enables external DNS resolution\n\n### How It Works\n\nWhen a pod wants to communicate\
  \ with a service, it queries CoreDNS:\n1. Pod queries: `my-service.default.svc.cluster.local`\n\
  2. CoreDNS resolves to the service's cluster IP\n3. kube-proxy routes traffic to\
  \ appropriate pod endpoints\n\n## Service DNS Names\n\nEvery Kubernetes service\
  \ gets a DNS name following this pattern:\n```\n<service-name>.<namespace>.svc.<cluster-domain>\n\
  ```\n\n**Examples:**\n- `web-service.production.svc.cluster.local` - Full FQDN\n\
  - `web-service.production` - Short form (works within cluster)\n- `web-service`\
  \ - Works only within same namespace\n\n### DNS Resolution Hierarchy\n\nPods have\
  \ DNS search paths configured:\n```\n<namespace>.svc.cluster.local\nsvc.cluster.local\n\
  cluster.local\n```\n\nThis allows short names like just `web-service` to resolve\
  \ when in the same namespace.\n\n## Stub Domains and Forwarding\n\nStub domains\
  \ allow you to route queries for specific domains to custom DNS servers:\n\n```yaml\n\
  apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns\n  namespace: kube-system\n\
  data:\n  Corefile: |\n    cluster.local:53 {\n        kubernetes cluster.local in-addr.arpa\
  \ ip6.arpa {\n          pods insecure\n          fallthrough in-addr.arpa ip6.arpa\n\
  \        }\n        forward . /etc/resolv.conf\n    }\n    example.com:53 {\n  \
  \      forward . 1.2.3.4\n    }\n```\n\n## SRV Records\n\nSRV records provide service\
  \ discovery with port information:\n```\n_<port-name>._<protocol>.<service-name>.<namespace>.svc.<cluster-domain>\n\
  ```\n\n**Example:**\n- Query: `_http._tcp.web-service.default.svc.cluster.local`\n\
  - Returns: Port number and target hosts\n\nThis is useful for:\n- Service discovery\
  \ across multiple ports\n- Load balancer configuration\n- Integration with legacy\
  \ systems\n\n## DNS Pod Configuration\n\nControl DNS behavior per-pod with `dnsPolicy`:\n\
  \n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: custom-dns-pod\nspec:\n\
  \  dnsPolicy: \"None\"  # None, Default, ClusterFirst, ClusterFirstWithHostNet\n\
  \  dnsConfig:\n    nameservers:\n      - 1.1.1.1\n    searches:\n      - my-namespace.svc.cluster.local\n\
  \    options:\n      - name: ndots\n        value: \"2\"\n```\n\n## Troubleshooting\
  \ DNS\n\n**Test DNS from a pod:**\n```bash\n# Create debug pod\nkubectl run -it\
  \ --rm debug --image=busybox --restart=Never -- sh\n\n# Inside pod\nnslookup kubernetes.default\n\
  nslookup my-service.my-namespace\ncat /etc/resolv.conf\n```\n\n**Check CoreDNS logs:**\n\
  ```bash\nkubectl logs -n kube-system -l k8s-app=kube-dns\n```\n\n**Common issues:**\n\
  - Pod can't resolve service names → Check CoreDNS is running\n- External DNS not\
  \ working → Check CoreDNS forwarding configuration\n- Slow DNS resolution → Adjust\
  \ ndots value\n\n## Key Points\n\n- CoreDNS provides DNS-based service discovery\
  \ in Kubernetes\n- Services get automatic DNS names: `<service>.<namespace>.svc.cluster.local`\n\
  - Stub domains enable custom DNS routing for specific domains\n- SRV records provide\
  \ port-aware service discovery\n- DNS configuration can be customized per-pod"
exercises:
- type: mcq
  slug: lesson-52-mcq
  sequence_order: 1
  question: What role does CoreDNS play in Kubernetes?
  options:
  - Provides DNS-based service discovery for pods and services within the cluster
  - Manages container images
  - Handles authentication
  - Monitors cluster health
  correct_answer_index: 0
  explanation: CoreDNS is the default DNS server in Kubernetes. It provides service
    discovery by resolving service names to cluster IPs, supports stub domains, and
    manages DNS search paths.
objectives:
- Understand the fundamental concepts and mechanisms of lesson 52
- Apply chemical principles to solve related problems
- Identify key reactions, equations, and chemical behaviors
next_recommended: []
