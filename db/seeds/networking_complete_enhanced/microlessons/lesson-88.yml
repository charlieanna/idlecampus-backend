slug: lesson-88
title: Lesson 88
sequence_order: 88
estimated_minutes: 2
difficulty: easy
content_md: "# Microlesson \U0001F680\n\n# Ingress Controllers Deep Dive\n\n## Introduction\n\
  \nIngress Controllers manage external HTTP/HTTPS access to services in a Kubernetes\
  \ cluster. Unlike Services (LoadBalancer/NodePort), Ingress provides:\n- Path-based\
  \ routing\n- Host-based routing\n- TLS/SSL termination\n- Name-based virtual hosting\n\
  - URL rewrites and redirects\n\n## How Ingress Works\n\n1. **Ingress Resource**\
  \ - YAML definition of routing rules\n2. **Ingress Controller** - Pod(s) that implement\
  \ the rules (nginx, Traefik, HAProxy, etc.)\n3. **Load Balancer** - External LB\
  \ (cloud) or NodePort exposing controller\n\n## Popular Ingress Controllers\n\n\
  ### NGINX Ingress Controller\n\nMost popular, feature-rich:\n```bash\n# Install\
  \ with Helm\nhelm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\n\
  helm install nginx-ingress ingress-nginx/ingress-nginx\n```\n\n### Traefik\nModern,\
  \ cloud-native with automatic service discovery:\n```bash\nhelm repo add traefik\
  \ https://helm.traefik.io/traefik\nhelm install traefik traefik/traefik\n```\n\n\
  ### HAProxy\nEnterprise-grade performance:\n```bash\nhelm repo add haproxytech https://haproxytech.github.io/helm-charts\n\
  helm install haproxy haproxytech/kubernetes-ingress\n```\n\n## Ingress Class\n\n\
  Multiple Ingress controllers can coexist using IngressClass:\n\n```yaml\napiVersion:\
  \ networking.k8s.io/v1\nkind: IngressClass\nmetadata:\n  name: nginx\n  annotations:\n\
  \    ingressclass.kubernetes.io/is-default-class: \"true\"\nspec:\n  controller:\
  \ k8s.io/ingress-nginx\n```\n\n**Using in Ingress:**\n```yaml\napiVersion: networking.k8s.io/v1\n\
  kind: Ingress\nmetadata:\n  name: my-ingress\nspec:\n  ingressClassName: nginx \
  \ # Specify which controller\n  rules:\n  - host: app.example.com\n    http:\n \
  \     paths:\n      - path: /\n        pathType: Prefix\n        backend:\n    \
  \      service:\n            name: my-service\n            port:\n             \
  \ number: 80\n```\n\n## Path-Based Routing\n\nRoute different URL paths to different\
  \ services:\n\n```yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n\
  \  name: path-routing\nspec:\n  rules:\n  - host: myapp.example.com\n    http:\n\
  \      paths:\n      - path: /api\n        pathType: Prefix\n        backend:\n\
  \          service:\n            name: api-service\n            port:\n        \
  \      number: 8080\n      - path: /web\n        pathType: Prefix\n        backend:\n\
  \          service:\n            name: frontend-service\n            port:\n   \
  \           number: 80\n      - path: /admin\n        pathType: Prefix\n       \
  \ backend:\n          service:\n            name: admin-service\n            port:\n\
  \              number: 3000\n```\n\n**PathTypes:**\n- `Exact` - Exact match only\n\
  - `Prefix` - Matches URL path prefix\n- `ImplementationSpecific` - Controller-specific\
  \ behavior\n\n## Host-Based Routing\n\nRoute different domains to different services:\n\
  \n```yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: host-routing\n\
  spec:\n  rules:\n  - host: api.example.com\n    http:\n      paths:\n      - path:\
  \ /\n        pathType: Prefix\n        backend:\n          service:\n          \
  \  name: api-service\n            port:\n              number: 80\n  - host: app.example.com\n\
  \    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n\
  \          service:\n            name: app-service\n            port:\n        \
  \      number: 80\n  - host: admin.example.com\n    http:\n      paths:\n      -\
  \ path: /\n        pathType: Prefix\n        backend:\n          service:\n    \
  \        name: admin-service\n            port:\n              number: 80\n```\n\
  \n## TLS/SSL Configuration\n\n### Single Certificate\n\n```yaml\napiVersion: networking.k8s.io/v1\n\
  kind: Ingress\nmetadata:\n  name: tls-ingress\nspec:\n  tls:\n  - hosts:\n    -\
  \ myapp.example.com\n    secretName: tls-secret\n  rules:\n  - host: myapp.example.com\n\
  \    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n\
  \          service:\n            name: my-service\n            port:\n         \
  \     number: 80\n```\n\n**Creating TLS Secret:**\n```bash\nkubectl create secret\
  \ tls tls-secret   --cert=path/to/cert.pem   --key=path/to/key.pem\n```\n\n### Multiple\
  \ Certificates (SNI)\n\n```yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress\n\
  metadata:\n  name: multi-tls\nspec:\n  tls:\n  - hosts:\n    - app1.example.com\n\
  \    secretName: app1-tls\n  - hosts:\n    - app2.example.com\n    secretName: app2-tls\n\
  \  rules:\n  - host: app1.example.com\n    http:\n      paths:\n      - path: /\n\
  \        pathType: Prefix\n        backend:\n          service:\n            name:\
  \ app1-service\n            port:\n              number: 80\n  - host: app2.example.com\n\
  \    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n\
  \          service:\n            name: app2-service\n            port:\n       \
  \       number: 80\n```\n\n## URL Rewrites\n\n### NGINX Rewrite Annotations\n\n\
  ```yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: rewrite-ingress\n\
  \  annotations:\n    nginx.ingress.kubernetes.io/rewrite-target: /$2\nspec:\n  rules:\n\
  \  - host: app.example.com\n    http:\n      paths:\n      - path: /api(/|$)(.*)\n\
  \        pathType: Prefix\n        backend:\n          service:\n            name:\
  \ api-service\n            port:\n              number: 8080\n```\n\n**How it works:**\n\
  - Request: `http://app.example.com/api/users`\n- Rewrites to: `http://api-service:8080/users`\n\
  \n### Redirect HTTP to HTTPS\n\n```yaml\napiVersion: networking.k8s.io/v1\nkind:\
  \ Ingress\nmetadata:\n  name: https-redirect\n  annotations:\n    nginx.ingress.kubernetes.io/ssl-redirect:\
  \ \"true\"\n    nginx.ingress.kubernetes.io/force-ssl-redirect: \"true\"\nspec:\n\
  \  tls:\n  - hosts:\n    - app.example.com\n    secretName: tls-secret\n  rules:\n\
  \  - host: app.example.com\n    http:\n      paths:\n      - path: /\n        pathType:\
  \ Prefix\n        backend:\n          service:\n            name: my-service\n \
  \           port:\n              number: 80\n```\n\n## Advanced Annotations\n\n\
  ### Rate Limiting\n\n```yaml\nmetadata:\n  annotations:\n    nginx.ingress.kubernetes.io/limit-rps:\
  \ \"10\"\n    nginx.ingress.kubernetes.io/limit-connections: \"5\"\n```\n\n### CORS\n\
  \n```yaml\nmetadata:\n  annotations:\n    nginx.ingress.kubernetes.io/enable-cors:\
  \ \"true\"\n    nginx.ingress.kubernetes.io/cors-allow-origin: \"https://example.com\"\
  \n    nginx.ingress.kubernetes.io/cors-allow-methods: \"GET, POST, PUT, DELETE\"\
  \n```\n\n### Client Body Size\n\n```yaml\nmetadata:\n  annotations:\n    nginx.ingress.kubernetes.io/proxy-body-size:\
  \ \"100m\"\n```\n\n### Custom Headers\n\n```yaml\nmetadata:\n  annotations:\n  \
  \  nginx.ingress.kubernetes.io/configuration-snippet: |\n      more_set_headers\
  \ \"X-Custom-Header: value\";\n      more_set_headers \"X-Another-Header: another-value\"\
  ;\n```\n\n### Authentication\n\n```yaml\nmetadata:\n  annotations:\n    nginx.ingress.kubernetes.io/auth-type:\
  \ basic\n    nginx.ingress.kubernetes.io/auth-secret: basic-auth\n    nginx.ingress.kubernetes.io/auth-realm:\
  \ 'Authentication Required'\n```\n\n## Troubleshooting\n\n### Check Controller Logs\n\
  \n```bash\nkubectl logs -n ingress-nginx -l app.kubernetes.io/name=ingress-nginx\
  \ -f\n```\n\n### Verify Ingress Status\n\n```bash\nkubectl get ingress\nkubectl\
  \ describe ingress my-ingress\n```\n\n### Test from Controller Pod\n\n```bash\n\
  kubectl exec -it -n ingress-nginx nginx-ingress-controller-xxx -- curl http://my-service.default.svc\n\
  ```\n\n### Common Issues\n\n**1. 404 Not Found:**\n- Check path and pathType\n-\
  \ Verify service and endpoints exist\n- Check controller logs\n\n**2. 502 Bad Gateway:**\n\
  - Service is down or unreachable\n- Check service endpoints\n- Verify pod health\n\
  \n**3. TLS not working:**\n- Verify secret exists and is valid\n- Check certificate\
  \ matches host\n- Ensure TLS section matches rules\n\n## Best Practices\n\n1. **Use\
  \ IngressClass** for multiple controllers\n2. **Set resource limits** on controller\
  \ pods\n3. **Enable metrics** for monitoring\n4. **Use TLS** for all production\
  \ traffic\n5. **Implement rate limiting** to prevent abuse\n6. **Set appropriate\
  \ timeouts** for long-running requests\n7. **Use path rewrites carefully** - test\
  \ thoroughly\n8. **Monitor controller metrics** - requests, latency, errors\n\n\
  ## Key Points\n\n- Ingress Controllers implement HTTP/HTTPS routing rules\n- IngressClass\
  \ allows multiple controllers in one cluster\n- Supports path-based, host-based\
  \ routing, and TLS termination\n- Annotations provide controller-specific advanced\
  \ features\n- URL rewrites enable flexible path transformations\n- Proper monitoring\
  \ and troubleshooting are essential"
exercises:
- type: mcq
  slug: lesson-88-mcq
  sequence_order: 1
  question: What is the primary purpose of an Ingress controller in Kubernetes?
  options:
  - To manage external HTTP/HTTPS access to services with path and host-based routing
  - To create pods automatically
  - To manage cluster storage
  - To handle pod scheduling
  correct_answer_index: 0
  explanation: An Ingress controller manages external access to services in a cluster,
    typically HTTP/HTTPS. It provides load balancing, SSL/TLS termination, and name-based
    virtual hosting.
objectives:
- Understand the fundamental concepts and mechanisms of lesson 88
- Apply chemical principles to solve related problems
- Identify key reactions, equations, and chemical behaviors
next_recommended: []
