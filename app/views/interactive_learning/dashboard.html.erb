<% content_for :title, "Learning Dashboard" %>

<div class="container mt-5">
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="display-4 mb-2">Learning Dashboard</h1>
      <p class="lead text-muted">Track your progress and continue learning</p>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row mb-5">
    <div class="col-md-3 mb-3">
      <div class="card">
        <div class="card-body text-center">
          <h3 class="text-success mb-1"><%= @completed_units %></h3>
          <p class="text-muted mb-0">Units Completed</p>
          <small class="text-muted">of <%= @total_units %> total</small>
        </div>
      </div>
    </div>
    
    <div class="col-md-3 mb-3">
      <div class="card">
        <div class="card-body text-center">
          <h3 class="text-warning mb-1"><%= @in_progress_units %></h3>
          <p class="text-muted mb-0">In Progress</p>
        </div>
      </div>
    </div>
    
    <div class="col-md-3 mb-3">
      <div class="card">
        <div class="card-body text-center">
          <h3 class="text-info mb-1"><%= @units_needing_review %></h3>
          <p class="text-muted mb-0">Need Review</p>
        </div>
      </div>
    </div>
    
    <div class="col-md-3 mb-3">
      <div class="card">
        <div class="card-body text-center">
          <% completion_rate = @total_units > 0 ? (@completed_units.to_f / @total_units * 100).round : 0 %>
          <h3 class="text-primary mb-1"><%= completion_rate %>%</h3>
          <p class="text-muted mb-0">Completion Rate</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Recent Progress -->
    <div class="col-lg-8 mb-4">
      <div class="card">
        <div class="card-header bg-white">
          <h5 class="mb-0">Recent Activity</h5>
        </div>
        <div class="card-body">
          <% if @recent_progress.any? %>
            <div class="list-group list-group-flush">
              <% @recent_progress.each do |progress| %>
                <% unit = progress.interactive_learning_unit %>
                <div class="list-group-item px-0">
                  <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                      <h6 class="mb-1">
                        <%= link_to unit.title, interactive_learning_path(unit.slug), class: "text-decoration-none" %>
                      </h6>
                      <div class="d-flex align-items-center">
                        <div class="progress flex-grow-1 mr-2" style="height: 6px; max-width: 200px;">
                          <div class="progress-bar <%= progress.completed? ? 'bg-success' : 'bg-primary' %>" 
                               style="width: <%= progress.completion_percentage %>%;"></div>
                        </div>
                        <small class="text-muted"><%= progress.completion_percentage %>%</small>
                      </div>
                      <small class="text-muted">
                        Updated <%= time_ago_in_words(progress.updated_at) %> ago
                      </small>
                    </div>
                    <div>
                      <% if progress.completed? %>
                        <span class="badge badge-success">Completed</span>
                      <% else %>
                        <%= link_to "Continue", interactive_learning_path(unit.slug), class: "btn btn-sm btn-primary" %>
                      <% end %>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-muted text-center py-4">No activity yet. Start learning!</p>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Recommended Units -->
    <div class="col-lg-4 mb-4">
      <div class="card">
        <div class="card-header bg-white">
          <h5 class="mb-0">Recommended for You</h5>
        </div>
        <div class="card-body">
          <% if @recommended_units.any? %>
            <div class="list-group list-group-flush">
              <% @recommended_units.each do |unit| %>
                <div class="list-group-item px-0 py-2">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <h6 class="mb-1">
                        <%= link_to unit.title, interactive_learning_path(unit.slug), class: "text-decoration-none" %>
                      </h6>
                      <small class="text-muted">
                        <i class="far fa-clock"></i> <%= unit.estimated_minutes %> min
                        <% case unit.difficulty_level
                           when 'easy' %>
                          <span class="badge badge-success badge-sm ml-1">Easy</span>
                        <% when 'medium' %>
                          <span class="badge badge-warning badge-sm ml-1">Medium</span>
                        <% when 'hard' %>
                          <span class="badge badge-danger badge-sm ml-1">Hard</span>
                        <% end %>
                      </small>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-muted text-center py-4">All caught up! ðŸŽ‰</p>
          <% end %>
        </div>
        <div class="card-footer bg-white">
          <%= link_to "View All Units", interactive_learning_index_path, class: "btn btn-outline-primary btn-block" %>
        </div>
      </div>
    </div>
  </div>
</div>

