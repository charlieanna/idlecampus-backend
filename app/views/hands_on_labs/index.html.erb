<div class="container-fluid">
  <div class="row">
    <!-- Sidebar with filters -->
    <div class="col-md-3 bg-light border-end" style="min-height: 100vh;">
      <div class="p-3">
        <h5 class="mb-3">Filter Labs</h5>
        
        <!-- Difficulty Filter -->
        <div class="mb-3">
          <label class="form-label">Difficulty</label>
          <%= form_with url: hands_on_labs_path, method: :get, local: true, class: "d-flex" do |f| %>
            <%= f.select :difficulty, 
                options_for_select([
                  ['All', ''],
                  ['Easy', 'easy'],
                  ['Medium', 'medium'],
                  ['Hard', 'hard']
                ], params[:difficulty]), 
                {}, 
                { class: "form-select", onchange: "this.form.submit()" } %>
          <% end %>
        </div>
        
        <!-- Category Filter -->
        <div class="mb-3">
          <label class="form-label">Category</label>
          <%= form_with url: hands_on_labs_path, method: :get, local: true, class: "d-flex" do |f| %>
            <%= f.select :category, 
                options_for_select([
                  ['All', ''],
                  ['Basics', 'basics'],
                  ['Containers', 'containers'],
                  ['Networking', 'networking'],
                  ['Images', 'images'],
                  ['Security', 'security'],
                  ['Orchestration', 'orchestration']
                ], params[:category]), 
                {}, 
                { class: "form-select", onchange: "this.form.submit()" } %>
          <% end %>
        </div>
        
        <!-- Lab Type Filter -->
        <div class="mb-3">
          <label class="form-label">Lab Type</label>
          <%= form_with url: hands_on_labs_path, method: :get, local: true, class: "d-flex" do |f| %>
            <%= f.select :lab_type, 
                options_for_select([
                  ['All', ''],
                  ['Docker', 'docker'],
                  ['Kubernetes', 'kubernetes'],
                  ['Docker Compose', 'docker-compose'],
                  ['Helm', 'helm']
                ], params[:lab_type]), 
                {}, 
                { class: "form-select", onchange: "this.form.submit()" } %>
          <% end %>
        </div>
        
        <!-- Clear Filters -->
        <%= link_to "Clear All Filters", hands_on_labs_path, class: "btn btn-outline-secondary btn-sm" %>
      </div>
    </div>

    <!-- Main content area -->
    <div class="col-md-9">
      <div class="p-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h1>Hands-On Labs</h1>
          <div class="text-muted">
            <%= @labs.count %> labs available
          </div>
        </div>

        <!-- Labs Grid -->
        <% if @labs.any? %>
          <div class="row">
            <% @labs.each do |lab| %>
              <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <span class="badge bg-<%= lab.difficulty == 'easy' ? 'success' : lab.difficulty == 'medium' ? 'warning' : 'danger' %>">
                      <%= lab.difficulty.titleize %>
                    </span>
                    <span class="badge bg-info">
                      <%= lab.lab_type.titleize %>
                    </span>
                  </div>
                  
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title"><%= lab.title %></h5>
                    <p class="card-text text-muted small">
                      <%= lab.description.present? ? truncate(lab.description, length: 100) : "Interactive hands-on lab" %>
                    </p>
                    
                    <div class="mt-auto">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <small class="text-muted">
                          <i class="fas fa-clock"></i> <%= lab.estimated_minutes %> min
                        </small>
                        <small class="text-muted">
                          <i class="fas fa-star"></i> <%= lab.points_reward %> pts
                        </small>
                      </div>
                      
                      <!-- Progress indicator -->
                      <% if @user_sessions[lab.id]&.any? %>
                        <% completed_sessions = @user_sessions[lab.id].select(&:completed?) %>
                        <% if completed_sessions.any? %>
                          <div class="progress mb-2" style="height: 6px;">
                            <div class="progress-bar bg-success" style="width: 100%"></div>
                          </div>
                          <small class="text-success">
                            <i class="fas fa-check-circle"></i> Completed
                          </small>
                        <% else %>
                          <div class="progress mb-2" style="height: 6px;">
                            <div class="progress-bar bg-warning" style="width: 50%"></div>
                          </div>
                          <small class="text-warning">
                            <i class="fas fa-play-circle"></i> In Progress
                          </small>
                        <% end %>
                      <% end %>
                    </div>
                  </div>
                  
                  <div class="card-footer">
                    <%= link_to "Start Lab", hands_on_lab_path(lab), class: "btn btn-primary w-100" %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-5">
            <i class="fas fa-flask fa-3x text-muted mb-3"></i>
            <h3>No labs found</h3>
            <p class="text-muted">Try adjusting your filters or check back later for new labs.</p>
            <%= link_to "Clear Filters", hands_on_labs_path, class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<style>
  .card {
    transition: transform 0.2s ease-in-out;
  }
  
  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  
  .badge {
    font-size: 0.75em;
  }
</style>
