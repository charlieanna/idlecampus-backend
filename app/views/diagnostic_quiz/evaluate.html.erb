<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <!-- Results Header -->
      <div class="text-center mb-5">
        <h1 class="display-4">Your Assessment Results</h1>
        <p class="lead text-muted">Here's your personalized learning path based on your current skills</p>
      </div>
      
      <!-- Overall Score Card -->
      <div class="card shadow-lg border-0 mb-4">
        <div class="card-body p-5">
          <div class="row align-items-center">
            <div class="col-md-4 text-center">
              <div class="skill-level-badge mb-3">
                <% badge_color = case @skill_level
                                 when 'beginner' then 'success'
                                 when 'novice' then 'info'
                                 when 'intermediate' then 'warning'
                                 when 'advanced' then 'danger'
                                 else 'primary'
                                 end %>
                <span class="badge badge-<%= badge_color %> p-4" style="font-size: 2rem;">
                  <%= @skill_level.titleize %>
                </span>
              </div>
              <h3>Your Skill Level</h3>
            </div>
            
            <div class="col-md-4 text-center">
              <div class="score-circle mb-3">
                <div class="progress-ring">
                  <svg width="120" height="120">
                    <circle cx="60" cy="60" r="54" fill="none" stroke="#e9ecef" stroke-width="8"/>
                    <circle cx="60" cy="60" r="54" fill="none" stroke="#007bff" stroke-width="8"
                            stroke-dasharray="<%= 339.292 * @results[:overall_score] / 100 %> 339.292"
                            stroke-dashoffset="0"
                            transform="rotate(-90 60 60)"/>
                  </svg>
                  <div class="score-text">
                    <span class="h2"><%= @results[:overall_score].round %>%</span>
                  </div>
                </div>
              </div>
              <h5>Overall Score</h5>
              <p class="text-muted">
                <%= @results[:correct_count] %> / <%= @results[:total_questions] %> correct
              </p>
            </div>
            
            <div class="col-md-4 text-center">
              <div class="recommendation-icon mb-3">
                <i class="fas fa-route fa-3x text-primary"></i>
              </div>
              <h5>Recommended Start</h5>
              <% if @recommended_course %>
                <p class="mb-2"><strong><%= @recommended_course.title %></strong></p>
                <%= link_to "Start Course", course_path(@recommended_course), 
                    class: "btn btn-primary" %>
              <% else %>
                <p class="text-muted">Browse courses to begin</p>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Skill Breakdown -->
      <div class="card shadow mb-4">
        <div class="card-header">
          <h4 class="mb-0"><i class="fas fa-chart-bar"></i> Skill Breakdown</h4>
        </div>
        <div class="card-body">
          <% @results[:skill_breakdown].each do |skill, score| %>
            <div class="mb-4">
              <div class="d-flex justify-content-between mb-1">
                <span class="font-weight-bold"><%= skill.humanize %></span>
                <span><%= score.round %>%</span>
              </div>
              <div class="progress" style="height: 20px;">
                <div class="progress-bar <%= score >= 70 ? 'bg-success' : score >= 50 ? 'bg-warning' : 'bg-danger' %>" 
                     role="progressbar" 
                     style="width: <%= score %>%">
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
      
      <!-- Personalized Learning Path -->
      <div class="card shadow mb-4">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">
            <i class="fas fa-road"></i> Your Personalized Learning Path
          </h4>
        </div>
        <div class="card-body">
          <div class="learning-path-timeline">
            <% @learning_path.each_with_index do |step, index| %>
              <div class="timeline-item <%= index == 0 ? 'active' : '' %>">
                <div class="timeline-marker">
                  <%= index + 1 %>
                </div>
                <div class="timeline-content">
                  <h5><%= step[:title] %></h5>
                  <p class="text-muted mb-2"><%= step[:description] %></p>
                  
                  <% if step[:estimated_days] %>
                    <span class="badge badge-secondary">
                      <i class="fas fa-calendar"></i> ~<%= step[:estimated_days] %> days
                    </span>
                  <% end %>
                  
                  <% if step[:course_id] %>
                    <%= link_to "View Course", course_path(step[:course_id]), 
                        class: "btn btn-sm btn-outline-primary mt-2" %>
                  <% elsif step[:type] == 'adaptive_practice' %>
                    <div class="mt-2">
                      <small class="text-info">
                        <i class="fas fa-brain"></i> 
                        Daily target: <%= step[:daily_target] %> questions
                      </small>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
      
      <!-- Next Steps -->
      <div class="row">
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-body text-center">
              <i class="fas fa-book-open fa-3x text-primary mb-3"></i>
              <h5>Ready to Start Learning?</h5>
              <p class="text-muted">Begin with the recommended course or browse all options</p>
              <div class="mt-3">
                <% if @recommended_course %>
                  <%= link_to "Start Recommended Course", 
                      enroll_course_path(@recommended_course), 
                      method: :post,
                      class: "btn btn-primary" %>
                <% end %>
                <%= link_to "Browse All Courses", courses_path, 
                    class: "btn btn-outline-primary #{@recommended_course ? 'ml-2' : ''}" %>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-body text-center">
              <i class="fas fa-brain fa-3x text-success mb-3"></i>
              <h5>Practice Makes Perfect</h5>
              <p class="text-muted">Start daily adaptive practice to reinforce learning</p>
              <%= link_to "Start Practice", start_adaptive_practice_path, 
                  class: "btn btn-success mt-3" %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .score-circle {
    position: relative;
    display: inline-block;
  }
  
  .score-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }
  
  .timeline-item {
    position: relative;
    padding-left: 60px;
    margin-bottom: 30px;
  }
  
  .timeline-marker {
    position: absolute;
    left: 0;
    top: 0;
    width: 40px;
    height: 40px;
    background: #e9ecef;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: #6c757d;
  }
  
  .timeline-item.active .timeline-marker {
    background: #007bff;
    color: white;
  }
  
  .timeline-item:not(:last-child):after {
    content: '';
    position: absolute;
    left: 19px;
    top: 45px;
    bottom: -25px;
    width: 2px;
    background: #e9ecef;
  }
  
  .skill-level-badge {
    animation: pulse 2s ease-in-out infinite;
  }
  
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }
</style>
