<div class="container-fluid p-0" style="min-height: 100vh;">
  <div class="bg-white" style="min-height: 100vh;">
    <div class="row no-gutters" style="min-height: 100vh;">
      <!-- Sidebar: Professional Course Navigation -->
      <div class="col-12 col-md-3" style="background: #1a1d29; min-height: 100vh; border-right: 1px solid #2d3246;">
        <div class="p-4" style="height: 100vh; overflow-y: auto;">
          <!-- Header -->
          <div class="mb-4 pb-3 border-bottom" style="border-color: #2d3246 !important;">
            <div class="d-flex align-items-center mb-2">
              <div class="rounded-circle d-flex align-items-center justify-content-center mr-3" style="width: 48px; height: 48px; background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);">
                <i class="fas fa-docker text-white" style="font-size: 24px;"></i>
              </div>
              <div>
                <h5 class="text-white font-weight-bold mb-0" style="font-size: 1rem;">Docker Fundamentals</h5>
                <p class="text-muted mb-0" style="font-size: 0.75rem; color: #6c757d !important;">CodeSprout Journey</p>
              </div>
            </div>
          </div>

          <!-- Progress Overview -->
          <div class="mb-4 pb-3 border-bottom" style="border-color: #2d3246 !important;">
            <% completed_count = (@stream_items || []).count { |item| item[:completed] } %>
            <% total_items = (@stream_items || []).length %>
            <% progress_percent = total_items > 0 ? (completed_count.to_f / total_items * 100).round : 0 %>
            
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-muted" style="font-size: 0.85rem; color: #9ca3af !important;">Course Progress</span>
              <span class="badge" style="background: #00d4ff; color: #1a1d29; font-weight: 600; font-size: 0.75rem;">
                <%= completed_count %>/<%= total_items %>
              </span>
            </div>
            <div class="progress" style="height: 8px; background: #2d3246; border-radius: 10px;">
              <div class="progress-bar" role="progressbar" style="width: <%= progress_percent %>%; background: linear-gradient(90deg, #00d4ff 0%, #0099cc 100%); border-radius: 10px;"></div>
            </div>
            <p class="text-muted mt-2 mb-0" style="font-size: 0.75rem; color: #6c757d !important;">
              <%= progress_percent %>% Complete
            </p>
          </div>

          <!-- Course Outline -->
          <div class="mb-3">
            <h6 class="text-uppercase font-weight-bold mb-3" style="font-size: 0.7rem; letter-spacing: 1.5px; color: #6c757d !important;">
              <i class="fas fa-list mr-2" style="color: #00d4ff;"></i>Course Outline
            </h6>

            <%# Group items by category %>
            <% grouped_items = (@stream_items || []).group_by { |item| item[:category] || 'containers' } %>

            <% grouped_items.each do |category, category_items| %>
              <div class="mb-4">
                <div class="d-flex align-items-center mb-2">
                  <i class="fas fa-folder mr-2" style="color: #00d4ff; font-size: 0.85rem;"></i>
                  <h6 class="font-weight-semibold mb-0" style="font-size: 0.8rem; color: #cbd5e0; text-transform: capitalize;">
                    <%= category %>
                  </h6>
                </div>

                <div class="ml-4">
                  <% category_items.each do |item| %>
                    <div class="mb-3">
                      <% if item[:type] == 'unit' %>
                        <% if item[:current] %>
                          <!-- Current Unit -->
                          <div class="p-3 rounded" style="background: linear-gradient(135deg, rgba(0, 212, 255, 0.15) 0%, rgba(0, 153, 204, 0.1) 100%); border-left: 3px solid #00d4ff;">
                            <div class="d-flex align-items-start">
                              <div class="rounded-circle d-flex align-items-center justify-content-center mr-3 flex-shrink-0" style="width: 36px; height: 36px; background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);">
                                <i class="fas fa-play text-white" style="font-size: 12px;"></i>
                              </div>
                              <div class="flex-grow-1">
                                <a href="<%= start_course_path(@course) %>" class="text-white font-weight-semibold text-decoration-none d-block mb-1" style="font-size: 0.9rem; line-height: 1.3;">
                                  <%= item[:title] %>
                                </a>
                                <span class="badge" style="background: #00d4ff; color: #1a1d29; font-size: 0.65rem; font-weight: 600;">In Progress</span>
                              </div>
                            </div>
                          </div>
                        <% elsif item[:completed] %>
                          <!-- Completed Unit -->
                          <div class="p-3 rounded" style="background: rgba(34, 197, 94, 0.1); border-left: 3px solid #22c55e;">
                            <div class="d-flex align-items-start">
                              <div class="rounded-circle d-flex align-items-center justify-content-center mr-3 flex-shrink-0" style="width: 36px; height: 36px; background: #22c55e;">
                                <i class="fas fa-check text-white" style="font-size: 12px;"></i>
                              </div>
                              <div class="flex-grow-1">
                                <% if item[:slug] %>
                                  <%# Link to stream with that unit as current item %>
                                  <a href="<%= start_course_path(@course, unit_slug: item[:slug]) %>" class="text-white font-weight-semibold text-decoration-none d-block mb-1" style="font-size: 0.9rem; line-height: 1.3; color: #cbd5e0 !important;">
                                    <%= item[:title] %>
                                  </a>
                                <% else %>
                                  <span class="text-white font-weight-semibold d-block mb-1" style="font-size: 0.9rem; line-height: 1.3; color: #cbd5e0 !important;">
                                    <%= item[:title] %>
                                  </span>
                                <% end %>
                                <% if item[:progress] %>
                                  <div class="d-flex align-items-center">
                                    <span class="badge" style="background: #22c55e; color: #1a1d29; font-size: 0.65rem; font-weight: 600; margin-right: 8px;">Completed</span>
                                    <span class="text-muted" style="font-size: 0.7rem; color: #6c757d !important;">
                                      <%= item[:progress][:mastery_score] ? "#{(item[:progress][:mastery_score] * 100).round}% mastery" : "" %>
                                    </span>
                                  </div>
                                <% else %>
                                  <span class="badge" style="background: #22c55e; color: #1a1d29; font-size: 0.65rem; font-weight: 600;">Completed</span>
                                <% end %>
                              </div>
                            </div>
                          </div>
                        <% else %>
                          <!-- Upcoming/Unlocked Unit -->
                          <div class="p-3 rounded" style="background: #2d3246; border-left: 3px solid #4b5563;">
                            <div class="d-flex align-items-start">
                              <div class="rounded-circle d-flex align-items-center justify-content-center mr-3 flex-shrink-0" style="width: 36px; height: 36px; background: #4b5563;">
                                <i class="fas fa-circle text-white" style="font-size: 12px;"></i>
                              </div>
                              <div class="flex-grow-1">
                                <% if item[:slug] %>
                                  <%# Link to stream with that unit as current item %>
                                  <a href="<%= start_course_path(@course, unit_slug: item[:slug]) %>" class="text-white font-weight-semibold text-decoration-none d-block mb-1" style="font-size: 0.9rem; line-height: 1.3; color: #cbd5e0 !important;">
                                    <%= item[:title] %>
                                  </a>
                                <% else %>
                                  <span class="text-white font-weight-semibold d-block mb-1" style="font-size: 0.9rem; line-height: 1.3; color: #cbd5e0 !important;">
                                    <%= item[:title] %>
                                  </span>
                                <% end %>
                                <span class="badge" style="background: #4b5563; color: #cbd5e0; font-size: 0.65rem; font-weight: 500;">Available</span>
                              </div>
                            </div>
                          </div>
                        <% end %>
                      <% else %>
                        <%# Lab item %>
                        <% if item[:current] %>
                          <!-- Current Lab -->
                          <div class="p-3 rounded" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(217, 119, 6, 0.1) 100%); border-left: 3px solid #fbbf24;">
                            <div class="d-flex align-items-start">
                              <div class="rounded-circle d-flex align-items-center justify-content-center mr-3 flex-shrink-0" style="width: 36px; height: 36px; background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);">
                                <i class="fas fa-flask text-white" style="font-size: 12px;"></i>
                              </div>
                              <div class="flex-grow-1">
                                <a href="<%= start_course_path(@course) %>" class="text-white font-weight-semibold text-decoration-none d-block mb-1" style="font-size: 0.9rem; line-height: 1.3;">
                                  <%= item[:title] %>
                                </a>
                                <span class="badge" style="background: #fbbf24; color: #1a1d29; font-size: 0.65rem; font-weight: 600;">Lab</span>
                              </div>
                            </div>
                          </div>
                        <% elsif item[:completed] %>
                          <!-- Completed Lab -->
                          <div class="p-3 rounded" style="background: rgba(34, 197, 94, 0.1); border-left: 3px solid #22c55e;">
                            <div class="d-flex align-items-start">
                              <div class="rounded-circle d-flex align-items-center justify-content-center mr-3 flex-shrink-0" style="width: 36px; height: 36px; background: #22c55e;">
                                <i class="fas fa-check text-white" style="font-size: 12px;"></i>
                              </div>
                              <div class="flex-grow-1">
                                <% if item[:id] %>
                                  <a href="<%= hands_on_lab_path(item[:id]) %>" class="text-white font-weight-semibold text-decoration-none d-block mb-1" style="font-size: 0.9rem; line-height: 1.3; color: #cbd5e0 !important;">
                                    <%= item[:title] %>
                                  </a>
                                <% else %>
                                  <span class="text-white font-weight-semibold d-block mb-1" style="font-size: 0.9rem; line-height: 1.3; color: #cbd5e0 !important;">
                                    <%= item[:title] %>
                                  </span>
                                <% end %>
                                <span class="badge" style="background: #22c55e; color: #1a1d29; font-size: 0.65rem; font-weight: 600;">Completed</span>
                              </div>
                            </div>
                          </div>
                        <% else %>
                          <!-- Unlocked Lab -->
                          <div class="p-3 rounded" style="background: #2d3246; border-left: 3px solid #4b5563;">
                            <div class="d-flex align-items-start">
                              <div class="rounded-circle d-flex align-items-center justify-content-center mr-3 flex-shrink-0" style="width: 36px; height: 36px; background: #4b5563;">
                                <i class="fas fa-circle text-white" style="font-size: 12px;"></i>
                              </div>
                              <div class="flex-grow-1">
                                <% if item[:id] %>
                                  <a href="<%= hands_on_lab_path(item[:id]) %>" class="text-white font-weight-semibold text-decoration-none d-block mb-1" style="font-size: 0.9rem; line-height: 1.3; color: #cbd5e0 !important;">
                                    <%= item[:title] %> <span class="text-muted" style="font-size: 0.75rem;">(Lab)</span>
                                  </a>
                                <% else %>
                                  <span class="text-white font-weight-semibold d-block mb-1" style="font-size: 0.9rem; line-height: 1.3; color: #cbd5e0 !important;">
                                    <%= item[:title] %> <span class="text-muted" style="font-size: 0.75rem;">(Lab)</span>
                                  </span>
                                <% end %>
                                <span class="badge" style="background: #4b5563; color: #cbd5e0; font-size: 0.65rem; font-weight: 500;">Available</span>
                              </div>
                            </div>
                          </div>
                        <% end %>
                      <% end %>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>

          <!-- Motivational Footer -->
          <div class="mt-4 pt-3 border-top" style="border-color: #2d3246 !important;">
            <div class="text-center">
              <div class="mb-2">
                <i class="fas fa-star" style="color: #fbbf24; font-size: 0.9rem;"></i>
                <i class="fas fa-star" style="color: #fbbf24; font-size: 0.9rem;"></i>
                <i class="fas fa-star" style="color: #fbbf24; font-size: 0.9rem;"></i>
                <i class="fas fa-star" style="color: #fbbf24; font-size: 0.9rem;"></i>
                <i class="fas fa-star" style="color: #fbbf24; font-size: 0.9rem;"></i>
              </div>
              <p class="text-muted mb-0" style="font-size: 0.75rem; color: #6c757d !important; font-style: italic;">
                "Master containers, master DevOps"
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Main content -->
      <div class="col-12 col-md-9">
        <div id="interactive-learning-container" data-props='<%= {
      unit: {
        slug: @unit.slug,
        title: @unit.title,
        concept_explanation: @unit.concept_explanation,
        scenario_narrative: @unit.scenario_narrative,
        problem_statement: @unit.problem_statement,
        command_to_learn: @unit.command_to_learn,
        command_variations: @unit.command_variations || [],
        practice_hints: @unit.practice_hints || [],
        code_examples: @code_examples || [],
        visual_aid_url: @unit.visual_aid_url,
        quiz_question_text: @unit.quiz_question_text,
        quiz_question_type: @unit.quiz_question_type,
        quiz_options: @quiz_options || [],
        quiz_explanation: @unit.quiz_explanation,
        quiz_correct_answer: @unit.quiz_correct_answer,
        scenario_description: @unit.scenario_description,
        scenario_steps: @scenario_steps || [],
        difficulty_level: @unit.difficulty_level,
        estimated_minutes: @unit.estimated_minutes,
        learning_objectives: @unit.learning_objectives || [],
        next_unit: nil
      },
      initialProgress: {
        explanation_read: @progress.explanation_read,
        practice_completed: @progress.practice_completed,
        quiz_answered: @progress.quiz_answered,
        scenario_completed: @progress.scenario_completed,
        completed: @progress.completed,
        completion_percentage: @progress.completion_percentage,
        mastery_score: @progress.mastery_score,
        practice_attempts: @progress.practice_attempts,
        quiz_attempts: @progress.quiz_attempts
      },
      csrfToken: form_authenticity_token,
      streamNextPath: start_course_path(@course)
    }.to_json %>'></div>
      </div>
    </div>
  </div>
</div>

<%= javascript_pack_tag 'course_stream' %>


