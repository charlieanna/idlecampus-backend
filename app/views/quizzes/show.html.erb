<div class="container mt-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><%= link_to "Courses", courses_path %></li>
      <% if @quiz.course_modules.any? %>
        <% course_module = @quiz.course_modules.first %>
        <li class="breadcrumb-item"><%= link_to course_module.course.title, course_path(course_module.course) %></li>
        <li class="breadcrumb-item"><%= link_to course_module.title, course_module_path(course_module.course, course_module) %></li>
      <% end %>
      <li class="breadcrumb-item active"><%= @quiz.title %></li>
    </ol>
  </nav>

  <div class="row">
    <!-- Quiz Info -->
    <div class="col-md-8">
      <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
          <h3 class="mb-0">
            <i class="fas fa-question-circle"></i> <%= @quiz.title %>
          </h3>
        </div>
        <div class="card-body">
          <p class="lead"><%= @quiz.description %></p>
          
          <div class="row mb-3">
            <div class="col-md-4">
              <div class="d-flex align-items-center">
                <i class="fas fa-list-ol text-primary me-2"></i>
                <div>
                  <strong><%= @quiz.quiz_questions.count %></strong> Questions
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="d-flex align-items-center">
                <i class="fas fa-clock text-info me-2"></i>
                <div>
                  <strong><%= @quiz.time_limit_minutes %></strong> Minutes
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="d-flex align-items-center">
                <i class="fas fa-trophy text-success me-2"></i>
                <div>
                  <strong><%= @quiz.passing_score %>%</strong> to Pass
                </div>
              </div>
            </div>
          </div>

          <hr>

          <h5>Quiz Rules:</h5>
          <ul>
            <li>You have <strong><%= @quiz.time_limit_minutes %> minutes</strong> to complete all questions</li>
            <li>You need <strong><%= @quiz.passing_score %>%</strong> or higher to pass</li>
            <li>Maximum <strong><%= @quiz.max_attempts %> attempts</strong> allowed</li>
            <% if @quiz.show_correct_answers %>
              <li>Correct answers will be shown after submission</li>
            <% end %>
            <% if @quiz.shuffle_questions %>
              <li>Questions will be presented in random order</li>
            <% end %>
          </ul>

          <div class="d-grid gap-2 mt-4">
            <%= button_to start_quiz_path(@quiz), method: :post, class: "btn btn-warning btn-lg" do %>
              <i class="fas fa-play"></i> Start Quiz
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Previous Attempts -->
    <div class="col-md-4">
      <div class="card">
        <div class="card-header bg-secondary text-white">
          <h5 class="mb-0"><i class="fas fa-history"></i> Your Attempts</h5>
        </div>
        <div class="card-body">
          <% if @attempts.any? %>
            <p class="text-muted small">
              Attempts used: <strong><%= @attempts.count %></strong> of <strong><%= @quiz.max_attempts %></strong>
            </p>
            
            <% @attempts.each_with_index do |attempt, index| %>
              <div class="card mb-2 <%= attempt.passed? ? 'border-success' : 'border-danger' %>">
                <div class="card-body p-2">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <strong>Attempt #<%= index + 1 %></strong>
                      <br>
                      <span class="badge bg-<%= attempt.passed? ? 'success' : 'danger' %>">
                        <%= attempt.score %>%
                      </span>
                    </div>
                    <div class="text-end">
                      <small class="text-muted">
                        <% if attempt.completed_at %>
                          <%= time_ago_in_words(attempt.completed_at) %> ago
                        <% else %>
                          In Progress
                        <% end %>
                      </small>
                      <br>
                      <% if attempt.completed_at %>
                        <%= link_to result_quiz_path(@quiz, attempt_id: attempt.id), class: "btn btn-sm btn-outline-primary" do %>
                          <i class="fas fa-eye"></i> View
                        <% end %>
                      <% else %>
                        <span class="badge bg-info">Ongoing</span>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>

            <% if @best_attempt %>
              <div class="alert alert-info mt-3">
                <i class="fas fa-star"></i> Best Score: <strong><%= @best_attempt.score %>%</strong>
              </div>
            <% end %>
          <% else %>
            <p class="text-muted">No attempts yet. Ready to start?</p>
          <% end %>

          <% if @attempts.count >= @quiz.max_attempts %>
            <div class="alert alert-warning mt-3">
              <i class="fas fa-exclamation-triangle"></i> Maximum attempts reached
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .card {
    transition: all 0.3s;
  }
  
  .card:hover {
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
</style>
