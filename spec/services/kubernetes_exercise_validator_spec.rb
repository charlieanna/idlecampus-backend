\nrequire 'rails_helper'\n\nRSpec.describe KubernetesExerciseValidator do\n  describe '.validate' do\n    context 'basic validation' do\n      it 'rejects empty commands' do\n        result = described_class.validate('', {})\n        expect(result[:valid]).to be false\n        expect(result[:message]).to eq('Please enter a command.')\n      end\n\n      it 'rejects whitespace-only commands' do\n        result = described_class.validate('   ', {})\n        expect(result[:valid]).to be false\n        expect(result[:message]).to eq('Please enter a command.')\n      end\n    end\n\n    context 'kubectl get pods command validation' do\n      it 'validates basic kubectl get pods' do\n        spec = { base_command: 'kubectl get pods' }\n        result = described_class.validate('kubectl get pods', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates kubectl get pod (singular)' do\n        spec = { base_command: ['kubectl get pods', 'kubectl get pod'] }\n        result = described_class.validate('kubectl get pod', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates kubectl get po (short form)' do\n        spec = { base_command: ['kubectl get pods', 'kubectl get po'] }\n        result = described_class.validate('kubectl get po', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates kubectl get pods -A' do\n        spec = { base_command: 'kubectl get pods', required_flags: ['-A'] }\n        result = described_class.validate('kubectl get pods -A', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates kubectl get pods -o wide' do\n        spec = { base_command: 'kubectl get pods', required_flags: ['-o wide'] }\n        result = described_class.validate('kubectl get pods -o wide', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates kubectl get pods --watch' do\n        spec = { base_command: 'kubectl get pods', required_flags: ['--watch'] }\n        result = described_class.validate('kubectl get pods --watch', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'rejects missing required flag' do\n        spec = { base_command: 'kubectl get pods', required_flags: ['-A'] }\n        result = described_class.validate('kubectl get pods', spec)\n        expect(result[:valid]).to be false\n        expect(result[:message]).to include('Missing required flag')\n      end\n    end\n\n    context 'kubectl create deployment validation' do\n      it 'validates basic deployment creation' do\n        spec = { base_command: 'kubectl create deployment', required_flags: ['--image=nginx'], requires_argument: true }\n        result = described_class.validate('kubectl create deployment nginx --image=nginx', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates deployment with replicas' do\n        spec = { base_command: 'kubectl create deployment', required_flags: ['--image=nginx', '--replicas=3'] }\n        result = described_class.validate('kubectl create deployment web --image=nginx --replicas=3', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates deployment with port' do\n        spec = { base_command: 'kubectl create deployment', required_flags: ['--image=nginx', '--port=80'] }\n        result = described_class.validate('kubectl create deployment web --image=nginx --port=80', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'rejects deployment without image' do\n        spec = { base_command: 'kubectl create deployment', required_flags: ['--image=nginx'] }\n        result = described_class.validate('kubectl create deployment web', spec)\n        expect(result[:valid]).to be false\n      end\n    end\n\n    context 'kubectl expose validation' do\n      it 'validates basic expose' do\n        spec = { base_command: 'kubectl expose deployment', required_flags: ['--port=80'] }\n        result = described_class.validate('kubectl expose deployment nginx --port=80', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates expose with NodePort' do\n        spec = { base_command: 'kubectl expose deployment', required_flags: ['--type=NodePort', '--port=80'] }\n        result = described_class.validate('kubectl expose deployment web --type=NodePort --port=80', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates expose with target-port' do\n        spec = { base_command: 'kubectl expose deployment', required_flags: ['--port=80', '--target-port=8080'] }\n        result = described_class.validate('kubectl expose deployment app --port=80 --target-port=8080', spec)\n        expect(result[:valid]).to be true\n      end\n    end\n\n    context 'kubectl scale validation' do\n      it 'validates basic scale' do\n        spec = { base_command: 'kubectl scale deployment', required_flags: ['--replicas=3'] }\n        result = described_class.validate('kubectl scale deployment web --replicas=3', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates scale with current-replicas' do\n        spec = { base_command: 'kubectl scale deployment', required_flags: ['--current-replicas=1', '--replicas=3'] }\n        result = described_class.validate('kubectl scale deployment web --current-replicas=1 --replicas=3', spec)\n        expect(result[:valid]).to be true\n      end\n    end\n\n    context 'kubectl logs validation' do\n      it 'validates basic logs' do\n        spec = { base_command: 'kubectl logs', requires_argument: true }\n        result = described_class.validate('kubectl logs my-pod', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates logs with follow' do\n        spec = { base_command: 'kubectl logs', required_flags: ['-f'], requires_argument: true }\n        result = described_class.validate('kubectl logs -f my-pod', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates logs with --previous' do\n        spec = { base_command: 'kubectl logs', required_flags: ['--previous'], requires_argument: true }\n        result = described_class.validate('kubectl logs --previous my-pod', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates logs with --tail' do\n        spec = { base_command: 'kubectl logs', required_flags: ['--tail=50'], requires_argument: true }\n        result = described_class.validate('kubectl logs --tail=50 my-pod', spec)\n        expect(result[:valid]).to be true\n      end\n    end\n\n    context 'kubectl exec validation' do\n      it 'validates exec with interactive shell' do\n        spec = { base_command: 'kubectl exec', required_flags: ['-it'], requires_argument: true }\n        result = described_class.validate('kubectl exec -it my-pod -- bash', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates exec with command' do\n        spec = { base_command: 'kubectl exec', requires_argument: true }\n        result = described_class.validate('kubectl exec my-pod -- ls /', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates exec with container specification' do\n        spec = { base_command: 'kubectl exec', required_flags: ['-it', '-c'], requires_argument: true }\n        result = described_class.validate('kubectl exec -it my-pod -c app-container -- bash', spec)\n        expect(result[:valid]).to be true\n      end\n    end\n\n    context 'kubectl apply validation' do\n      it 'validates apply with file' do\n        spec = { base_command: 'kubectl apply', required_flags: ['-f', 'app.yaml'] }\n        result = described_class.validate('kubectl apply -f app.yaml', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates apply with directory' do\n        spec = { base_command: 'kubectl apply', required_flags: ['-f', './configs/'] }\n        result = described_class.validate('kubectl apply -f ./configs/', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates apply with URL' do\n        spec = { base_command: 'kubectl apply', required_flags: ['-f'] }\n        result = described_class.validate('kubectl apply -f https://k8s.io/examples/application/deployment.yaml', spec)\n        expect(result[:valid]).to be true\n      end\n    end\n\n    context 'kubectl delete validation' do\n      it 'validates delete pod' do\n        spec = { base_command: 'kubectl delete pod', requires_argument: true }\n        result = described_class.validate('kubectl delete pod old-pod', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates delete with file' do\n        spec = { base_command: 'kubectl delete', required_flags: ['-f', 'app.yaml'] }\n        result = described_class.validate('kubectl delete -f app.yaml', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates delete with label selector' do\n        spec = { base_command: 'kubectl delete pods', required_flags: ['-l', 'app=test'] }\n        result = described_class.validate('kubectl delete pods -l app=test', spec)\n        expect(result[:valid]).to be true\n      end\n    end\n\n    context 'kubectl describe validation' do\n      it 'validates describe pod' do\n        spec = { base_command: 'kubectl describe pod', requires_argument: true }\n        result = described_class.validate('kubectl describe pod my-pod', spec)\n        expect(result[:valid]).to be true\n      end\n\n      it 'validates describe deployment' do\n        spec = { base_command: 'kubectl describe deployment', requires_argument: true }\n        result = described_class.validate('k